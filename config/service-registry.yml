# Service Registry for AI-Powered Contract Testing
# ================================================
# 
# This file is AUTO-GENERATED by the AI detection system.
# Manual edits are allowed but will be overwritten if AI re-detects.
#
# Structure:
#   services:
#     <service-name>:
#       consumer_of: [list of providers this service consumes]
#       provider_to: [list of consumers this service provides to]
#       detection:
#         detected_at: ISO timestamp
#         confidence: 0.0-1.0
#         method: how it was detected
#         evidence: what code/files indicated this
#
# Last updated: AUTO-UPDATED

version: "1.0"

services:
  # ============================================
  # Pet Project Services
  # ============================================
  
  pact-implementation:
    # This is the consumer demo service
    consumer_of:
      - pact-provider-demo
    provider_to: []
    detection:
      detected_at: "2024-01-15T10:30:00Z"
      confidence: 1.0
      method: "manual"
      evidence: "Initial setup - consumer demo repository"
  
  pact-provider-demo:
    # This is the provider demo service
    consumer_of: []
    provider_to:
      - pact-implementation
    detection:
      detected_at: "2024-01-15T10:30:00Z"
      confidence: 1.0
      method: "manual"
      evidence: "Initial setup - provider demo repository"
  
  # ============================================
  # Staffbase Services (to be added)
  # ============================================
  
  # email-service:
  #   consumer_of:
  #     - email-content-convertor
  #   provider_to: []
  #   detection:
  #     detected_at: null
  #     confidence: null
  #     method: "pending"
  #     evidence: null
  
  # email-content-convertor:
  #   consumer_of: []
  #   provider_to:
  #     - email-service
  #   detection:
  #     detected_at: null
  #     confidence: null
  #     method: "pending"
  #     evidence: null

# ============================================
# Pact Naming Convention
# ============================================
# 
# Consumer tests publish pacts with names:
#   {consumer}-{provider}
#
# Examples:
#   - pact-implementation → pact-provider-demo
#     Pact name: "pact-implementation-pact-provider-demo"
#   
#   - email-service → email-content-convertor
#     Pact name: "email-service-email-content-convertor"
#
# This naming is used by:
#   - Consumer tests (when publishing)
#   - Provider verification (when fetching pacts)
#   - Pactflow webhooks (when triggering)

# ============================================
# Detection Methods
# ============================================
#
# manual:      Manually configured by developer
# pact_broker: Detected from existing pacts in Pact Broker
# ai_analysis: AI analyzed PR/codebase to detect relationships
# config_file: Read from .contract-testing.yml in target repo

# ============================================
# How This File Is Used
# ============================================
#
# 1. Workflow triggers with service_name
# 2. Pipeline looks up service_name in this registry
# 3. If found:
#    - consumer_of is not empty → run consumer workflow
#    - provider_to is not empty → run provider workflow
#    - both have values → run both workflows
# 4. If not found:
#    - Query Pact Broker for existing relationships
#    - If still not found, AI analyzes PR changes
#    - Add detected relationships to this file
# 5. After successful workflow run, update this file
